# 세마포어 & 뮤텍스 (Semaphore & Mutex)
작성자: 장수현

<br>

## Thread-Safe

멀티스레드 환경에서 여러 스레드가 동시에 하나의 객체 및 변수(공유 자원)에 접근할 때, 의도한 대로 동작하는 것을 말한다. 

Thread-safe하기 위해서는 공유 자원에 접근하는 임계영역(critical section)을 동기화 기법으로 제어해줘야 한다. 

이를 '상호배제'라고 한다. 동기화 기법으로는 뮤텍스(Mutex) 나 세마포어(Semaphore) 등이 있다.

<br>

## 뮤텍스 (Mutex)

공유된 자원의 데이터, 임계영역 등에 **하나의 프로세스나 스레드가 접근하는 것을 막는다.** (동기화 대상이 하나)

임계구역을 가진 프로세스나 스레드들의 실행시간이 서로 겹치지 않고 각각 단독으로 실행되도록 하는 기술이다.

**한 프로세스에 의해 소유될 수 있는 Key를 기반**으로 한 상호배제 기법이고 Key에 해당하는 어떤 객체가 있으며, 이 객체를 소유한 스레드/프로세스만이 공유자원에 접근할 수 있다.

다중 프로세스들의 공유 리소스에 대한 접근을 조율하기 위해 동기화(Synchronization) 또는 락(Lock)을 사용함으로써 뮤텍스 객체를 두 스레드가 동시에 사용할 수 없다.

<br>

## 세마포어 (Semaphore)

공유된 자원의 데이터, 임계영역 등에 **여러 프로세스나 스레드가 접근하는 것을 막는다.** (동기화 대상이 하나 이상)

**사용하고 있는 스레드/프로세스의 수를 공통으로 관리하는 하나의 값을 이용해** 상호배제를 달성한다.

공유 자원에 접근할 수 있는 프로세스의 최대 허용치만큼 동시에 사용자가 접근할 수 있으며, 각 프로세스는 세마포어의 값을 확인하고 변경할 수 있다.

자원을 사용하지 않는 상태가 될 때, 대기하던 프로세스가 즉시 자원을 사용한다. 이미 다른 프로세스에 의해 사용 중이라면 일정시간 대기해야 한다.

<br>

## 뮤텍스 VS 세마포어

1. 관리하는 동기화 대상의 개수: 뮤텍스는 동기화 대상이 하나일 때, 세마포어는 동기화 대상이 하나 이상일 때 사용한다.
2. 세마포어는 뮤텍스가 될 수 있지만, 뮤텍스는 세마포어가 될 수 없다.
3. 세마포어는 소유할 수 없지만, 뮤텍스는 소유가 가능하며 소유주가 이에 대한 책임을 가진다.
4. 뮤텍스는 뮤텍스를 소유하고 있는 스레드가 이 뮤텍스를 해제할 수 있다. 하지만, 세마포어는 세마포어를 소유하지 않는 스레드가 이 세마포어를 해제할 수 있다.
5. 세마포어는 시스템 범위에 걸쳐있고 파일 시스템상의 파일 형태로 존재한다. 반면, 뮤텍스는 프로세스 범위를 가지며 프로세스가 종료될 때 자동으로 사라진다.

<br>

---
- [뮤텍스와 세마포어의 차이](https://worthpreading.tistory.com/90)